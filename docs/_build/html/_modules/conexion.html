<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>conexion &#8212; documentación de alvarezgomez - 1.0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=4936afed"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=f85f4cfb"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Código fuente para conexion</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtSql</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.uic.properties</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">var</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mapper</span>

<div class="viewcode-block" id="Conexion">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Conexion</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Método de una clase que no depende de una instancia específica de esa clase.</span>
<span class="sd">    Se puede llamarlo directamente a través de la clase, sin necesidad de crear un objeto de esa clase. </span>
<span class="sd">    Es útil en comportamientos o funcionalidades que son más a una clase en general que a una instancia en particular.</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Conexion.db_conexion">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.db_conexion">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">db_conexion</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param None: None</span>
<span class="sd">        :type None: None</span>
<span class="sd">        :return:False or True</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Módulo para establecer conexión con la base de datos.</span>
<span class="sd">        Si éxito devuelve true, en caso contrario devuelve false</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verifica si el archivo de base de datos existe</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;bbdd.sqlite&#39;</span><span class="p">):</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;El archivo de la base de datos no existe.&#39;</span><span class="p">,</span>
                                           <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Crear la conexión con la base de datos SQLite</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlDatabase</span><span class="o">.</span><span class="n">addDatabase</span><span class="p">(</span><span class="s1">&#39;QSQLITE&#39;</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setDatabaseName</span><span class="p">(</span><span class="s1">&#39;bbdd.sqlite&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">open</span><span class="p">():</span>
            <span class="c1"># Verificar si la base de datos contiene tablas</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>  <span class="c1"># Si no hay tablas</span>
                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Base de datos vacía o no válida.&#39;</span><span class="p">,</span>
                                               <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Aviso&#39;</span><span class="p">,</span> <span class="s1">&#39;Conexión Base de Datos realizada&#39;</span><span class="p">,</span>
                                               <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;No se pudo abrir la base de datos.&#39;</span><span class="p">,</span>
                                           <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listar_provincias">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listar_provincias">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_provincias</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param None: None</span>
<span class="sd">        :type None: None</span>
<span class="sd">        :return: lista provincias</span>
<span class="sd">        :rtype: bytearray</span>

<span class="sd">        Método que obtiene listado de provincias de la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listaprov</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM provincias;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">listaprov</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">listaprov</span></div>


<div class="viewcode-block" id="Conexion.listar_municipios">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listar_municipios">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_municipios</span><span class="p">(</span><span class="n">prov_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param prov_id: id provincia</span>
<span class="sd">        :type prov_id: int</span>
<span class="sd">        :return: lista de municipios de la provincia con el id pasado por parámetro</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que obtiene listado de municipios de una provincia de la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mun_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM municipios where idprov = </span><span class="si">{</span><span class="n">prov_id</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">mun_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">mun_list</span></div>


<div class="viewcode-block" id="Conexion.listar_all_municipios">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listar_all_municipios">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_all_municipios</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param none: none</span>
<span class="sd">        :type: none</span>
<span class="sd">        :return: lista de todas las provincias existentes en la base de datos</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que obtiene un listado de todas los municipios existentes en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mun_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM municipios;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">mun_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">mun_list</span></div>


<div class="viewcode-block" id="Conexion.alta_cliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.alta_cliente">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">alta_cliente</span><span class="p">(</span><span class="n">cliente</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param cliente: cliente a dar de alta</span>
<span class="sd">        :type cliente: dict</span>
<span class="sd">        :return: id del cliente registrado o -1</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        Método que inserta a la base de datos el cliente</span>
<span class="sd">        Si éxito devuelve el id del cliente, en caso contrario devuelve -1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into clientes (dnicli, altacli, apelcli, nomecli, emailcli, movilcli, &quot;</span>
                          <span class="s2">&quot;dircli, procli, municli, bajacli) VALUES (:dnicli, :altacli, :apelcli, :nomecli, :emailcli, &quot;</span>
                          <span class="s2">&quot; :movilcli, :dircli, :procli, :municli, :bajacli)&quot;</span><span class="p">)</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">bind_cliente_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">cliente</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">lastInsertId</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error alta cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>


<div class="viewcode-block" id="Conexion.listar_clientes">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listar_clientes">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_clientes</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param None: None</span>
<span class="sd">        :type None: None</span>
<span class="sd">        :return: listado clientes</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve una lista con los clientes de la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clientes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cliente</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_cliente</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cliente</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">state_manager</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;historico_cli&quot;</span><span class="p">]:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes WHERE bajacli IS NULL ORDER BY nomecli, apelcli ASC;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes ORDER BY nomecli, apelcli ASC;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">cliente</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">clientes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cliente</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">clientes</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado clientes&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.get_cliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.get_cliente">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cliente</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param dni: DNI del cliente que se quiere obtener de la base de datos</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :return: cliente correspondiente al dni pasado por parametro</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        Método que a partir de un DNI obtiene el usuario de la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cliente</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_cliente</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cliente</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">state_manager</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;historico_cli&quot;</span><span class="p">]:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes WHERE dnicli = :dni AND bajacli IS NULL;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM clientes WHERE dnicli = :dni;&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="n">dni</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">cliente</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">cliente</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos un cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="Conexion.modificar_cliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modificar_cliente">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">modificar_cliente</span><span class="p">(</span><span class="n">cliente</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param cliente: cliente a modificar</span>
<span class="sd">        :type cliente: dict</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que actualiza un cliente en la base de datos</span>
<span class="sd">        Si éxito devuelve True, en caso contrario devuelve False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;select count(*) from clientes where dnicli = :dni&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;dni&quot;</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE clientes SET altacli = :altacli, apelcli = :apelcli, nomecli = :nomecli, &quot;</span>
                            <span class="s2">&quot;emailcli = :emailcli, movilcli = :movilcli, dircli = :dircli, procli = :procli, &quot;</span>
                            <span class="s2">&quot;municli = :municli, bajacli = :bajacli WHERE dnicli = :dnicli&quot;</span><span class="p">)</span>

                <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">bind_cliente_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">cliente</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error modificar cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.baja_cliente">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.baja_cliente">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">baja_cliente</span><span class="p">(</span><span class="n">cliente</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param cliente: cliente a dar de baja</span>
<span class="sd">        :type cliente: dict</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que da de baja un cliente en la base de datos (lo oculta añadiéndole una fecha de baja)</span>
<span class="sd">        Si éxito devuelve True, en caso contrario devuelve False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE clientes SET bajacli = :bajacli WHERE dnicli = :dnicli&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajacli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;fecha_baja&quot;</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dnicli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;dni&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error baja cliente&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.alta_propiedad_tipo">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.alta_propiedad_tipo">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">alta_propiedad_tipo</span><span class="p">(</span><span class="n">tipo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param tipo: tipo de propiedad a dar de alta</span>
<span class="sd">        :type tipo: str</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método para registrar un tipo de propiedad en la base de datos</span>
<span class="sd">        Si éxito devuelve True, en caso contrario devuelve False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into tipopropiedad (TIPO) VALUES (:tipo) &quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tipo</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT tipo FROM tipopropiedad&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error alta tipo propiedad&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.cargar_propiedad_tipos">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.cargar_propiedad_tipos">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cargar_propiedad_tipos</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param None: None</span>
<span class="sd">        :type None: None</span>
<span class="sd">        :return: listado de tipos de propiedad de la base de datos</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve un listado con todos los tipos de propiedades en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT tipo FROM tipopropiedad ORDER BY tipo ASC&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="n">tipos</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">tipos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">tipos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.baja_propiedad_tipo">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.baja_propiedad_tipo">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">baja_propiedad_tipo</span><span class="p">(</span><span class="n">tipo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param None: None</span>
<span class="sd">        :type None: None</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que elimina de la base de datos el tipo de propiedad pasado por parametro</span>
<span class="sd">        Si éxito devuelve True, en caso contrario False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE from tipopropiedad WHERE tipo = :tipo&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipo&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tipo</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">numRowsAffected</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error baja tipo propiedad&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.alta_propiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.alta_propiedad">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">alta_propiedad</span><span class="p">(</span><span class="n">propiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param propiedad: propiedad a registrar en la base de datos</span>
<span class="sd">        :type propiedad: dict</span>
<span class="sd">        :return: id de la última propiedad registrada o -1</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        Método que registra en la base de datos la propiedad pasada por parámetro</span>
<span class="sd">        Si éxito devuelve id de la última propiedad registrada, en caso contrario -1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into propiedades (altaprop, dirprop, provprop, muniprop, tipoprop, habprop, &quot;</span>
                          <span class="s2">&quot;banprop, superprop, prealquiprop, prevenprop, cpprop, obserprop, tipooper, estadoprop, &quot;</span>
                          <span class="s2">&quot;nomeprop, movilprop) VALUES (:altaprop, :dirprop, :provprop, :muniprop, :tipoprop, :habprop, &quot;</span>
                          <span class="s2">&quot;:banprop, :superprop, :prealquiprop, :prevenprop, :cpprop, :obserprop, :tipooper, :estadoprop, &quot;</span>
                          <span class="s2">&quot;:nomeprop, :movilprop)&quot;</span><span class="p">)</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">bind_propiedad_create_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">propiedad</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">lastInsertId</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error al dar de alta la propiedad en la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>


<div class="viewcode-block" id="Conexion.modificar_propiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modificar_propiedad">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">modificar_propiedad</span><span class="p">(</span><span class="n">propiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param propiedad: propiedad a modificar en la base de datos</span>
<span class="sd">        :type propiedad: dict</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que actualiza una propiedad en la base de datos</span>
<span class="sd">        Si éxito devuelve True, en caso contrario False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE propiedades SET altaprop = :altaprop, dirprop = :dirprop, provprop = :provprop, &quot;</span>
                          <span class="s2">&quot;muniprop = :muniprop, tipoprop = :tipoprop, habprop = :habprop, banprop = :banprop, &quot;</span>
                          <span class="s2">&quot;superprop = :superprop, prealquiprop = :prealquiprop, prevenprop = :prevenprop, &quot;</span>
                          <span class="s2">&quot;cpprop = :cpprop, obserprop = :obserprop, tipooper = :tipooper, estadoprop = :estadoprop, &quot;</span>
                          <span class="s2">&quot;nomeprop = :nomeprop, movilprop = :movilprop, bajaprop = :bajaprop WHERE codigo = :codigo&quot;</span><span class="p">)</span>

            <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">bind_propiedad_update_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">propiedad</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al modificar la propiedad en la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.eliminar_propiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.eliminar_propiedad">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eliminar_propiedad</span><span class="p">(</span><span class="n">propiedad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param propiedad: propiedad a dar de baja en la base de datos</span>
<span class="sd">        :type propiedad: dict</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que da de baja una propiedad en la base de datos (la oculta añadiéndole una fecha de baja)</span>
<span class="sd">        Si éxito devuelve True, en caso contrario False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE propiedades SET bajaprop = :bajaprop, estadoprop = :estadoprop WHERE codigo = :codigo&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaprop&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="s2">&quot;fecha_baja&quot;</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:estadoprop&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">propiedad</span><span class="p">[</span><span class="s2">&quot;estado&quot;</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="n">propiedad</span><span class="p">[</span><span class="s2">&quot;codigo&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al dar de baja la propiedad en la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listar_propiedades">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listar_propiedades">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_propiedades</span><span class="p">(</span><span class="n">to_export</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param to_export: bandera para controlar si el listado de propiedades es para realizar una exportación</span>
<span class="sd">        :type to_export: bool</span>
<span class="sd">        :return: listado de propiedades existentes en la base de datos</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve una lista con las propiedades existentes en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">propiedades</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">propiedad</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_propiedad</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">propiedad</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">state_manager</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;historico_pro&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">to_export</span><span class="p">:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE bajaprop IS NULL ORDER BY muniprop ASC;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades ORDER BY muniprop ASC;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">propiedad</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">propiedades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">propiedad</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">propiedades</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado propiedades&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.get_propiedad">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.get_propiedad">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_propiedad</span><span class="p">(</span><span class="n">codigo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param codigo: código de la propiedad a obtener desde la base de datos</span>
<span class="sd">        :type codigo: int</span>
<span class="sd">        :return: propiedad correspondiente al código pasado por parámetro</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        Método que obtiene una propiedad de la base de datos a partir de su código</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">propiedad</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_propiedad</span><span class="p">()</span>

            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">propiedad</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE codigo = :codigo;&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="n">codigo</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">propiedad</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">propiedad</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error al obtener la propiedad de la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="Conexion.filtrar_propiedades">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.filtrar_propiedades">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">filtrar_propiedades</span><span class="p">(</span><span class="n">tipo</span><span class="p">,</span> <span class="n">municipio</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param tipo: tipo de propiedad para filtrar</span>
<span class="sd">        :type tipo: str</span>
<span class="sd">        :param municipio: municipio para filtrar</span>
<span class="sd">        :type municipio: str</span>
<span class="sd">        :return: listado de propiedades filtradas</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve una lista de propiedades filtradas</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">propiedades</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">propiedad</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_propiedad</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">propiedad</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">state_manager</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;historico_pro&quot;</span><span class="p">]:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE tipoprop = :tipoprop AND muniprop = :muniprop AND bajaprop IS NULL ORDER BY muniprop ASC;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM propiedades WHERE tipoprop = :tipoprop AND muniprop = :muniprop ORDER BY muniprop ASC;&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:tipoprop&quot;</span><span class="p">,</span> <span class="n">tipo</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:muniprop&quot;</span><span class="p">,</span> <span class="n">municipio</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">propiedad</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">propiedades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">propiedad</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">propiedades</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al filtrar propiedades en la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>



<div class="viewcode-block" id="Conexion.alta_vendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.alta_vendedor">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">alta_vendedor</span><span class="p">(</span><span class="n">vendedor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param vendedor: vendedor a dar de alta en la base de datos</span>
<span class="sd">        :type vendedor: dict</span>
<span class="sd">        :return: id del último vendedor registrado o -1</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        Método que registra un vendedor en la base de datos</span>
<span class="sd">        Si éxito devuelve el id del vendedor registrado, en caso contrario -1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT into vendedores (dniVendedor, nombreVendedor, altaVendedor, &quot;</span>
                          <span class="s2">&quot;movilVendedor, mailVendedor, delegacionVendedor) VALUES (:dniven, :nomven, :altaven, &quot;</span>
                          <span class="s2">&quot;:movilven, :mailven, :delven)&quot;</span><span class="p">)</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">bind_vendedor_create_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">vendedor</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">lastInsertId</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error al dar de alta al vendedor en la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>


<div class="viewcode-block" id="Conexion.modificar_vendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modificar_vendedor">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">modificar_vendedor</span><span class="p">(</span><span class="n">vendedor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param vendedor: vendedor a actualizar en la base de datos</span>
<span class="sd">        :type vendedor: dict</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que actualiza un vendedor en la base de datos</span>
<span class="sd">        Si éxito devuelve True, en caso contrario False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE vendedores SET dniVendedor = :dniven, nombreVendedor = :nomven, altaVendedor = :altaven, bajaVendedor = :bajaven, &quot;</span>
                          <span class="s2">&quot;movilVendedor = :movilven, mailVendedor = :mailven, delegacionVendedor = :delven WHERE idVendedor = :idven&quot;</span><span class="p">)</span>

            <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">bind_vendedor_update_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">vendedor</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al modificar el vendedor en la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.baja_vendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.baja_vendedor">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">baja_vendedor</span><span class="p">(</span><span class="n">vendedor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param vendedor: vendedor a dar de baja en la base de datos</span>
<span class="sd">        :type vendedor: dict</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que da de baja un vendedor en la base de datos (lo oculta añadiéndole una fecha de baja)</span>
<span class="sd">        Si éxito devuelve True, en caso contrario devuelve False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE vendedores SET bajaVendedor = :bajaven WHERE idVendedor = :idven&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:bajaven&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vendedor</span><span class="p">[</span><span class="s2">&quot;fecha_baja&quot;</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idven&quot;</span><span class="p">,</span> <span class="n">vendedor</span><span class="p">[</span><span class="s2">&quot;codigo&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al dar de baja la propiedad en la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listar_vendedores">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listar_vendedores">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_vendedores</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param None: None</span>
<span class="sd">        :type None: None</span>
<span class="sd">        :return: listado de vendedores existentes en la base de datos</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve un listado de los vendedores existentes en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vendedores</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vendedor</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_vendedor</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vendedor</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">state_manager</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;historico_ven&quot;</span><span class="p">]:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedores WHERE bajaVendedor IS NULL ORDER BY idVendedor ASC;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedores ORDER BY idVendedor ASC;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">vendedor</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">vendedores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vendedor</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">vendedores</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado clientes&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.get_vendedor">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.get_vendedor">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_vendedor</span><span class="p">(</span><span class="n">codigo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param codigo: código del vendedor a obtener desde la base de datos</span>
<span class="sd">        :type codigo: int</span>
<span class="sd">        :return: vendedor correspondiente al código pasado por parámetro</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        Método que devuelve desde la base de datos un vendedor a partir de su código</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vendedor</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_vendedor</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vendedor</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedores WHERE idVendedor = :codigo;&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:codigo&quot;</span><span class="p">,</span> <span class="n">codigo</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">vendedor</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">vendedor</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos un vendedor&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="Conexion.get_vendedor_dni">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.get_vendedor_dni">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_vendedor_dni</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param dni: dni del vendedor a obtener desde la base de datos</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :return: vendedor correspondiente al dni pasado por parámetro</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        Método que devuelve desde la base de datos un vendedor a partir de su dni</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vendedor</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_vendedor</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vendedor</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vendedores WHERE dniVendedor = :dni;&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="n">dni</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">vendedor</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">vendedor</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos un vendedor&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="Conexion.alta_factura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.alta_factura">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">alta_factura</span><span class="p">(</span><span class="n">factura</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param factura: factura a almacenar en la base de datos</span>
<span class="sd">        :type factura: dict</span>
<span class="sd">        :return: id de la última factura registrada o -1</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        Método que registra una factura en la base de datos</span>
<span class="sd">        Si éxito devuelve el id de la factura registrada, en caso contrario -1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT INTO facturas (fechafac, dnicli) VALUES (:fechafac, :dnicli)&quot;</span><span class="p">)</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">bind_factura_create_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">factura</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">lastInsertId</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error alta_factura&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.listar_facturas">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listar_facturas">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_facturas</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param None: None</span>
<span class="sd">        :type None: None</span>
<span class="sd">        :return: listado de facturas existentes en la base de datos</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Método que devuelve un listado de las facturas existentes en la base de datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">facturas</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">factura</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_factura</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">factura</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM facturas ORDER BY id ASC;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">factura</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">facturas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factura</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">facturas</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error listado facturas&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>

        
<div class="viewcode-block" id="Conexion.get_factura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.get_factura">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_factura</span><span class="p">(</span><span class="n">factura_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param id: ID de la factura a obtener desde la base de datos</span>
<span class="sd">        :type codigo: int</span>
<span class="sd">        :return: factura correspondiente al ID pasado por parámetro</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        Método que devuelve desde la base de datos una factura a partir de su ID</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">factura</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_factura</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">factura</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM facturas WHERE id = :id;&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="n">factura_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">factura</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">factura</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos una factura&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="Conexion.eliminar_factura">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.eliminar_factura">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">eliminar_factura</span><span class="p">(</span><span class="n">factura</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param factura: factura a borrar en la base de datos</span>
<span class="sd">        :type factura: dict</span>
<span class="sd">        :return: True o False</span>
<span class="sd">        :rtype: bool</span>

<span class="sd">        Método que borra una factura de la base de datos</span>
<span class="sd">        Devuelve True si la factura de borró con éxito y False en caso contrario</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM facturas WHERE id = :id;&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">factura</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al eliminar factura&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.alta_venta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.alta_venta">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">alta_venta</span><span class="p">(</span><span class="n">venta</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ventas (facventa, codprop, codagente, precioventa) &quot;</span>
                          <span class="s2">&quot;VALUES (:id_factura, :codigo_propiedad, :codigo_vendedor, :precio);&quot;</span><span class="p">)</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">bind_venta_create_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">venta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">lastInsertId</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al dar de alta la venta&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.listar_ventas">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listar_ventas">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_ventas</span><span class="p">():</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Conexion.get_venta">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.get_venta">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_venta</span><span class="p">(</span><span class="n">venta_id</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">venta</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">Mapper</span><span class="o">.</span><span class="n">initialize_venta</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">venta</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM ventas WHERE idventa = :venta_id;&quot;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:venta_id&quot;</span><span class="p">,</span> <span class="n">venta_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">venta</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">venta</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al obtener venta desde la base de datos&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">alvarezgomez</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navegación</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Código de módulo</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Manuel Alvarez.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>